{
   "groups": [
      {
         "name": "kube-apiserver.rules",
         "rules": [
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[1d]))\n    -\n    (\n      (\n        sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=~\"resource|\",le=\"0.1\"}[1d]))\n        or\n        vector(0)\n      )\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"namespace\",le=\"0.5\"}[1d]))\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"cluster\",le=\"5\"}[1d]))\n    )\n  )\n  +\n  # errors\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\",code=~\"5..\"}[1d]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[1d]))\n",
               "labels": {
                  "verb": "read"
               },
               "record": "apiserver_request:burnrate1d"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[1h]))\n    -\n    (\n      (\n        sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=~\"resource|\",le=\"0.1\"}[1h]))\n        or\n        vector(0)\n      )\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"namespace\",le=\"0.5\"}[1h]))\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"cluster\",le=\"5\"}[1h]))\n    )\n  )\n  +\n  # errors\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\",code=~\"5..\"}[1h]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[1h]))\n",
               "labels": {
                  "verb": "read"
               },
               "record": "apiserver_request:burnrate1h"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[2h]))\n    -\n    (\n      (\n        sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=~\"resource|\",le=\"0.1\"}[2h]))\n        or\n        vector(0)\n      )\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"namespace\",le=\"0.5\"}[2h]))\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"cluster\",le=\"5\"}[2h]))\n    )\n  )\n  +\n  # errors\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\",code=~\"5..\"}[2h]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[2h]))\n",
               "labels": {
                  "verb": "read"
               },
               "record": "apiserver_request:burnrate2h"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[30m]))\n    -\n    (\n      (\n        sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=~\"resource|\",le=\"0.1\"}[30m]))\n        or\n        vector(0)\n      )\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"namespace\",le=\"0.5\"}[30m]))\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"cluster\",le=\"5\"}[30m]))\n    )\n  )\n  +\n  # errors\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\",code=~\"5..\"}[30m]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[30m]))\n",
               "labels": {
                  "verb": "read"
               },
               "record": "apiserver_request:burnrate30m"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[3d]))\n    -\n    (\n      (\n        sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=~\"resource|\",le=\"0.1\"}[3d]))\n        or\n        vector(0)\n      )\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"namespace\",le=\"0.5\"}[3d]))\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"cluster\",le=\"5\"}[3d]))\n    )\n  )\n  +\n  # errors\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\",code=~\"5..\"}[3d]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[3d]))\n",
               "labels": {
                  "verb": "read"
               },
               "record": "apiserver_request:burnrate3d"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[5m]))\n    -\n    (\n      (\n        sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=~\"resource|\",le=\"0.1\"}[5m]))\n        or\n        vector(0)\n      )\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"namespace\",le=\"0.5\"}[5m]))\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"cluster\",le=\"5\"}[5m]))\n    )\n  )\n  +\n  # errors\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\",code=~\"5..\"}[5m]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[5m]))\n",
               "labels": {
                  "verb": "read"
               },
               "record": "apiserver_request:burnrate5m"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[6h]))\n    -\n    (\n      (\n        sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=~\"resource|\",le=\"0.1\"}[6h]))\n        or\n        vector(0)\n      )\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"namespace\",le=\"0.5\"}[6h]))\n      +\n      sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"cluster\",le=\"5\"}[6h]))\n    )\n  )\n  +\n  # errors\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\",code=~\"5..\"}[6h]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[6h]))\n",
               "labels": {
                  "verb": "read"
               },
               "record": "apiserver_request:burnrate6h"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[1d]))\n    -\n    sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",le=\"1\"}[1d]))\n  )\n  +\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",code=~\"5..\"}[1d]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[1d]))\n",
               "labels": {
                  "verb": "write"
               },
               "record": "apiserver_request:burnrate1d"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[1h]))\n    -\n    sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",le=\"1\"}[1h]))\n  )\n  +\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",code=~\"5..\"}[1h]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[1h]))\n",
               "labels": {
                  "verb": "write"
               },
               "record": "apiserver_request:burnrate1h"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[2h]))\n    -\n    sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",le=\"1\"}[2h]))\n  )\n  +\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",code=~\"5..\"}[2h]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[2h]))\n",
               "labels": {
                  "verb": "write"
               },
               "record": "apiserver_request:burnrate2h"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[30m]))\n    -\n    sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",le=\"1\"}[30m]))\n  )\n  +\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",code=~\"5..\"}[30m]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[30m]))\n",
               "labels": {
                  "verb": "write"
               },
               "record": "apiserver_request:burnrate30m"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[3d]))\n    -\n    sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",le=\"1\"}[3d]))\n  )\n  +\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",code=~\"5..\"}[3d]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[3d]))\n",
               "labels": {
                  "verb": "write"
               },
               "record": "apiserver_request:burnrate3d"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[5m]))\n    -\n    sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",le=\"1\"}[5m]))\n  )\n  +\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",code=~\"5..\"}[5m]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[5m]))\n",
               "labels": {
                  "verb": "write"
               },
               "record": "apiserver_request:burnrate5m"
            },
            {
               "expr": "(\n  (\n    # too slow\n    sum(rate(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[6h]))\n    -\n    sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",le=\"1\"}[6h]))\n  )\n  +\n  sum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\",code=~\"5..\"}[6h]))\n)\n/\nsum(rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[6h]))\n",
               "labels": {
                  "verb": "write"
               },
               "record": "apiserver_request:burnrate6h"
            },
            {
               "expr": "sum by (code,resource) (rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[5m]))\n",
               "labels": {
                  "verb": "read"
               },
               "record": "code_resource:apiserver_request_total:rate5m"
            },
            {
               "expr": "sum by (code,resource) (rate(apiserver_request_total{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[5m]))\n",
               "labels": {
                  "verb": "write"
               },
               "record": "code_resource:apiserver_request_total:rate5m"
            },
            {
               "expr": "histogram_quantile(0.99, sum by (le, resource) (rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[5m]))) > 0\n",
               "labels": {
                  "quantile": "0.99",
                  "verb": "read"
               },
               "record": "cluster_quantile:apiserver_request_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.99, sum by (le, resource) (rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"POST|PUT|PATCH|DELETE\"}[5m]))) > 0\n",
               "labels": {
                  "quantile": "0.99",
                  "verb": "write"
               },
               "record": "cluster_quantile:apiserver_request_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.99, sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",subresource!=\"log\",verb!~\"LIST|WATCH|WATCHLIST|DELETECOLLECTION|PROXY|CONNECT\"}[5m])) without(instance, pod))\n",
               "labels": {
                  "quantile": "0.99"
               },
               "record": "cluster_quantile:apiserver_request_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.9, sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",subresource!=\"log\",verb!~\"LIST|WATCH|WATCHLIST|DELETECOLLECTION|PROXY|CONNECT\"}[5m])) without(instance, pod))\n",
               "labels": {
                  "quantile": "0.9"
               },
               "record": "cluster_quantile:apiserver_request_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.5, sum(rate(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",subresource!=\"log\",verb!~\"LIST|WATCH|WATCHLIST|DELETECOLLECTION|PROXY|CONNECT\"}[5m])) without(instance, pod))\n",
               "labels": {
                  "quantile": "0.5"
               },
               "record": "cluster_quantile:apiserver_request_duration_seconds:histogram_quantile"
            }
         ]
      },
      {
         "interval": "3m",
         "name": "kube-apiserver-availability.rules",
         "rules": [
            {
               "expr": "1 - (\n  (\n    # write too slow\n    sum(increase(apiserver_request_duration_seconds_count{verb=~\"POST|PUT|PATCH|DELETE\"}[30d]))\n    -\n    sum(increase(apiserver_request_duration_seconds_bucket{verb=~\"POST|PUT|PATCH|DELETE\",le=\"1\"}[30d]))\n  ) +\n  (\n    # read too slow\n    sum(increase(apiserver_request_duration_seconds_count{verb=~\"LIST|GET\"}[30d]))\n    -\n    (\n      (\n        sum(increase(apiserver_request_duration_seconds_bucket{verb=~\"LIST|GET\",scope=~\"resource|\",le=\"0.1\"}[30d]))\n        or\n        vector(0)\n      )\n      +\n      sum(increase(apiserver_request_duration_seconds_bucket{verb=~\"LIST|GET\",scope=\"namespace\",le=\"0.5\"}[30d]))\n      +\n      sum(increase(apiserver_request_duration_seconds_bucket{verb=~\"LIST|GET\",scope=\"cluster\",le=\"5\"}[30d]))\n    )\n  ) +\n  # errors\n  sum(code:apiserver_request_total:increase30d{code=~\"5..\"} or vector(0))\n)\n/\nsum(code:apiserver_request_total:increase30d)\n",
               "labels": {
                  "verb": "all"
               },
               "record": "apiserver_request:availability30d"
            },
            {
               "expr": "1 - (\n  sum(increase(apiserver_request_duration_seconds_count{app=\"kube-apiserver\",verb=~\"LIST|GET\"}[30d]))\n  -\n  (\n    # too slow\n    (\n      sum(increase(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=~\"resource|\",le=\"0.1\"}[30d]))\n      or\n      vector(0)\n    )\n    +\n    sum(increase(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"namespace\",le=\"0.5\"}[30d]))\n    +\n    sum(increase(apiserver_request_duration_seconds_bucket{app=\"kube-apiserver\",verb=~\"LIST|GET\",scope=\"cluster\",le=\"5\"}[30d]))\n  )\n  +\n  # errors\n  sum(code:apiserver_request_total:increase30d{verb=\"read\",code=~\"5..\"} or vector(0))\n)\n/\nsum(code:apiserver_request_total:increase30d{verb=\"read\"})\n",
               "labels": {
                  "verb": "read"
               },
               "record": "apiserver_request:availability30d"
            },
            {
               "expr": "1 - (\n  (\n    # too slow\n    sum(increase(apiserver_request_duration_seconds_count{verb=~\"POST|PUT|PATCH|DELETE\"}[30d]))\n    -\n    sum(increase(apiserver_request_duration_seconds_bucket{verb=~\"POST|PUT|PATCH|DELETE\",le=\"1\"}[30d]))\n  )\n  +\n  # errors\n  sum(code:apiserver_request_total:increase30d{verb=\"write\",code=~\"5..\"} or vector(0))\n)\n/\nsum(code:apiserver_request_total:increase30d{verb=\"write\"})\n",
               "labels": {
                  "verb": "write"
               },
               "record": "apiserver_request:availability30d"
            },
            {
               "expr": "avg_over_time(code_verb:apiserver_request_total:increase1h[30d]) * 24 * 30\n",
               "record": "code_verb:apiserver_request_total:increase30d"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"LIST\",code=~\"2..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"GET\",code=~\"2..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"POST\",code=~\"2..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"PUT\",code=~\"2..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"PATCH\",code=~\"2..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"DELETE\",code=~\"2..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"LIST\",code=~\"3..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"GET\",code=~\"3..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"POST\",code=~\"3..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"PUT\",code=~\"3..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"PATCH\",code=~\"3..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"DELETE\",code=~\"3..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"LIST\",code=~\"4..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"GET\",code=~\"4..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"POST\",code=~\"4..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"PUT\",code=~\"4..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"PATCH\",code=~\"4..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"DELETE\",code=~\"4..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"LIST\",code=~\"5..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"GET\",code=~\"5..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"POST\",code=~\"5..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"PUT\",code=~\"5..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"PATCH\",code=~\"5..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code, verb) (increase(apiserver_request_total{app=\"kube-apiserver\",verb=\"DELETE\",code=~\"5..\"}[1h]))\n",
               "record": "code_verb:apiserver_request_total:increase1h"
            },
            {
               "expr": "sum by (code) (code_verb:apiserver_request_total:increase30d{verb=~\"LIST|GET\"})\n",
               "labels": {
                  "verb": "read"
               },
               "record": "code:apiserver_request_total:increase30d"
            },
            {
               "expr": "sum by (code) (code_verb:apiserver_request_total:increase30d{verb=~\"POST|PUT|PATCH|DELETE\"})\n",
               "labels": {
                  "verb": "write"
               },
               "record": "code:apiserver_request_total:increase30d"
            }
         ]
      },
      {
         "name": "k8s.rules",
         "rules": [
            {
               "expr": "sum by (cluster_id, namespace, pod, container) (\n  rate(container_cpu_usage_seconds_total{app=\"cadvisor\", image!=\"\"}[5m])\n) * on (cluster_id, namespace, pod) group_left(node) topk by (cluster_id, namespace, pod) (\n  1, max by(cluster_id, namespace, pod, node) (kube_pod_info{node!=\"\"})\n)\n",
               "record": "node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate"
            },
            {
               "expr": "container_memory_working_set_bytes{app=\"cadvisor\", image!=\"\"}\n* on (namespace, pod) group_left(node) topk by(namespace, pod) (1,\n  max by(namespace, pod, node) (kube_pod_info{node!=\"\"})\n)\n",
               "record": "node_namespace_pod_container:container_memory_working_set_bytes"
            },
            {
               "expr": "container_memory_rss{app=\"cadvisor\", image!=\"\"}\n* on (namespace, pod) group_left(node) topk by(namespace, pod) (1,\n  max by(namespace, pod, node) (kube_pod_info{node!=\"\"})\n)\n",
               "record": "node_namespace_pod_container:container_memory_rss"
            },
            {
               "expr": "container_memory_cache{app=\"cadvisor\", image!=\"\"}\n* on (namespace, pod) group_left(node) topk by(namespace, pod) (1,\n  max by(namespace, pod, node) (kube_pod_info{node!=\"\"})\n)\n",
               "record": "node_namespace_pod_container:container_memory_cache"
            },
            {
               "expr": "container_memory_swap{app=\"cadvisor\", image!=\"\"}\n* on (namespace, pod) group_left(node) topk by(namespace, pod) (1,\n  max by(namespace, pod, node) (kube_pod_info{node!=\"\"})\n)\n",
               "record": "node_namespace_pod_container:container_memory_swap"
            },
            {
               "expr": "sum by (namespace, cluster) (\n    sum by (namespace, pod, cluster) (\n        max by (namespace, pod, container, cluster) (\n          kube_pod_container_resource_requests{resource=\"memory\",app=\"kube-state-metrics\"}\n        ) * on(namespace, pod, cluster) group_left() max by (namespace, pod) (\n          kube_pod_status_phase{phase=~\"Pending|Running\"} == 1\n        )\n    )\n)\n",
               "record": "namespace_memory:kube_pod_container_resource_requests:sum"
            },
            {
               "expr": "sum by (namespace, cluster) (\n    sum by (namespace, pod, cluster) (\n        max by (namespace, pod, container, cluster) (\n          kube_pod_container_resource_requests{resource=\"cpu\",app=\"kube-state-metrics\"}\n        ) * on(namespace, pod, cluster) group_left() max by (namespace, pod) (\n          kube_pod_status_phase{phase=~\"Pending|Running\"} == 1\n        )\n    )\n)\n",
               "record": "namespace_cpu:kube_pod_container_resource_requests:sum"
            },
            {
               "expr": "max by (cluster_id, namespace, workload, pod) (\n  label_replace(\n    label_replace(\n      kube_pod_owner{app=\"kube-state-metrics\", owner_kind=\"ReplicaSet\"},\n      \"replicaset\", \"$1\", \"owner_name\", \"(.*)\"\n    ) * on(replicaset, namespace) group_left(owner_name) topk by(replicaset, namespace) (\n      1, max by (replicaset, namespace, owner_name) (\n        kube_replicaset_owner{app=\"kube-state-metrics\"}\n      )\n    ),\n    \"workload\", \"$1\", \"owner_name\", \"(.*)\"\n  )\n)\n",
               "labels": {
                  "workload_type": "deployment"
               },
               "record": "namespace_workload_pod:kube_pod_owner:relabel"
            },
            {
               "expr": "max by (cluster_id, namespace, workload, pod) (\n  label_replace(\n    kube_pod_owner{app=\"kube-state-metrics\", owner_kind=\"DaemonSet\"},\n    \"workload\", \"$1\", \"owner_name\", \"(.*)\"\n  )\n)\n",
               "labels": {
                  "workload_type": "daemonset"
               },
               "record": "namespace_workload_pod:kube_pod_owner:relabel"
            },
            {
               "expr": "max by (cluster_id, namespace, workload, pod) (\n  label_replace(\n    kube_pod_owner{app=\"kube-state-metrics\", owner_kind=\"StatefulSet\"},\n    \"workload\", \"$1\", \"owner_name\", \"(.*)\"\n  )\n)\n",
               "labels": {
                  "workload_type": "statefulset"
               },
               "record": "namespace_workload_pod:kube_pod_owner:relabel"
            }
         ]
      },
      {
         "name": "kube-scheduler.rules",
         "rules": [
            {
               "expr": "histogram_quantile(0.99, sum(rate(scheduler_e2e_scheduling_duration_seconds_bucket{app=\"kube-scheduler\"}[5m])) without(instance, pod))\n",
               "labels": {
                  "quantile": "0.99"
               },
               "record": "cluster_quantile:scheduler_e2e_scheduling_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.99, sum(rate(scheduler_scheduling_algorithm_duration_seconds_bucket{app=\"kube-scheduler\"}[5m])) without(instance, pod))\n",
               "labels": {
                  "quantile": "0.99"
               },
               "record": "cluster_quantile:scheduler_scheduling_algorithm_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.99, sum(rate(scheduler_binding_duration_seconds_bucket{app=\"kube-scheduler\"}[5m])) without(instance, pod))\n",
               "labels": {
                  "quantile": "0.99"
               },
               "record": "cluster_quantile:scheduler_binding_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.9, sum(rate(scheduler_e2e_scheduling_duration_seconds_bucket{app=\"kube-scheduler\"}[5m])) without(instance, pod))\n",
               "labels": {
                  "quantile": "0.9"
               },
               "record": "cluster_quantile:scheduler_e2e_scheduling_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.9, sum(rate(scheduler_scheduling_algorithm_duration_seconds_bucket{app=\"kube-scheduler\"}[5m])) without(instance, pod))\n",
               "labels": {
                  "quantile": "0.9"
               },
               "record": "cluster_quantile:scheduler_scheduling_algorithm_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.9, sum(rate(scheduler_binding_duration_seconds_bucket{app=\"kube-scheduler\"}[5m])) without(instance, pod))\n",
               "labels": {
                  "quantile": "0.9"
               },
               "record": "cluster_quantile:scheduler_binding_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.5, sum(rate(scheduler_e2e_scheduling_duration_seconds_bucket{app=\"kube-scheduler\"}[5m])) without(instance, pod))\n",
               "labels": {
                  "quantile": "0.5"
               },
               "record": "cluster_quantile:scheduler_e2e_scheduling_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.5, sum(rate(scheduler_scheduling_algorithm_duration_seconds_bucket{app=\"kube-scheduler\"}[5m])) without(instance, pod))\n",
               "labels": {
                  "quantile": "0.5"
               },
               "record": "cluster_quantile:scheduler_scheduling_algorithm_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.5, sum(rate(scheduler_binding_duration_seconds_bucket{app=\"kube-scheduler\"}[5m])) without(instance, pod))\n",
               "labels": {
                  "quantile": "0.5"
               },
               "record": "cluster_quantile:scheduler_binding_duration_seconds:histogram_quantile"
            }
         ]
      },
      {
         "name": "node.rules",
         "rules": [
            {
               "expr": "topk by(namespace, pod) (1,\n  max by (node, namespace, pod) (\n    label_replace(kube_pod_info{app=\"kube-state-metrics\",node!=\"\"}, \"pod\", \"$1\", \"pod\", \"(.*)\")\n))\n",
               "record": "node_namespace_pod:kube_pod_info:"
            },
            {
               "expr": "count by (cluster_id, node) (sum by (node, cpu) (\n  node_cpu_seconds_total{app=\"node-exporter\"}\n* on (namespace, pod) group_left(node)\n  topk by(namespace, pod) (1, node_namespace_pod:kube_pod_info:)\n))\n",
               "record": "node:node_num_cpu:sum"
            },
            {
               "expr": "sum(\n  node_memory_MemAvailable_bytes{app=\"node-exporter\"} or\n  (\n    node_memory_Buffers_bytes{app=\"node-exporter\"} +\n    node_memory_Cached_bytes{app=\"node-exporter\"} +\n    node_memory_MemFree_bytes{app=\"node-exporter\"} +\n    node_memory_Slab_bytes{app=\"node-exporter\"}\n  )\n) by (cluster_id)\n",
               "record": ":node_memory_MemAvailable_bytes:sum"
            }
         ]
      },
      {
         "name": "kubelet.rules",
         "rules": [
            {
               "expr": "histogram_quantile(0.99, sum(rate(kubelet_pleg_relist_duration_seconds_bucket[5m])) by (instance, le) * on(instance) group_left(node) kubelet_node_name{app=\"kubelet\"})\n",
               "labels": {
                  "quantile": "0.99"
               },
               "record": "node_quantile:kubelet_pleg_relist_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.9, sum(rate(kubelet_pleg_relist_duration_seconds_bucket[5m])) by (instance, le) * on(instance) group_left(node) kubelet_node_name{app=\"kubelet\"})\n",
               "labels": {
                  "quantile": "0.9"
               },
               "record": "node_quantile:kubelet_pleg_relist_duration_seconds:histogram_quantile"
            },
            {
               "expr": "histogram_quantile(0.5, sum(rate(kubelet_pleg_relist_duration_seconds_bucket[5m])) by (instance, le) * on(instance) group_left(node) kubelet_node_name{app=\"kubelet\"})\n",
               "labels": {
                  "quantile": "0.5"
               },
               "record": "node_quantile:kubelet_pleg_relist_duration_seconds:histogram_quantile"
            }
         ]
      }
   ]
}
